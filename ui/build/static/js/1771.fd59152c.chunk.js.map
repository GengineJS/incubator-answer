{"version":3,"file":"static/js/1771.fd59152c.chunk.js","mappings":"8QAgCA,IAAIA,EACJ,MAAMC,EAAYA,KAAO,IAADC,EACtB,MAAM,EAAEC,IAAMC,EAAAA,EAAAA,GAAe,cAAe,CAAEC,UAAW,gBACnDC,GAAWC,EAAAA,EAAAA,MACXC,GAAUC,EAAAA,EAAAA,MAAkBC,MAC5BC,GAAmB,OAAPH,QAAO,IAAPA,GAAmB,QAAZN,EAAPM,EAASI,kBAAU,IAAAV,OAAZ,EAAPA,EAAqBW,OAAQ,IACxCC,EAAeC,IAAoBC,EAAAA,EAAAA,UAAS,IAC7CC,EAAqBC,IACpBA,IAGLC,EAAAA,EAAAA,kBAAiBD,GAAKE,MAAMC,IACtBA,EAAIC,SACNC,EAAAA,GAAAA,qBAA2BF,EAAIG,MAAOlB,IAGxCmB,aAAazB,GACbA,EAAa0B,YAAW,KACtBT,EAAkBC,EAAI,GACrB,KAAK,GACR,EAmCyC,IAADS,EAAAC,EAA5C,OArBAC,EAAAA,EAAAA,YAAU,KACHlB,IAGLmB,EAAAA,EAAAA,gBAAeV,MAAMC,IAhBDU,OAiBdC,EAAAA,EAAAA,QAAgBC,EAAAA,GAAiBC,MACnCC,EAAAA,GAAiB7B,SAAY,OAAHe,QAAG,IAAHA,OAAG,EAAHA,EAAKe,aAAc,CAC3CC,QAAS,cAnBKN,EAsBA,OAAHV,QAAG,IAAHA,OAAG,EAAHA,EAAKe,eAlBtBE,EAAAA,UAAiBP,EAAW,CAAEQ,MAAO,IAAKC,OAAQ,IAAK,CAACC,EAAKC,KACvDD,GAGJ1B,EAAiB2B,EAAI,IAenBzB,EAAqB,OAAHI,QAAG,IAAHA,OAAG,EAAHA,EAAKH,KACzB,GACA,GACD,CAACP,KACJkB,EAAAA,EAAAA,YAAU,IACD,KACLJ,aAAazB,EAAW,GAEzB,KAECgC,EAAAA,EAAAA,QAAgBC,EAAAA,GAAiBC,OAEjCS,EAAAA,EAAAA,KAACC,EAAAA,EAAI,CAACC,UAAU,cAAaC,UAC3BC,EAAAA,EAAAA,MAACH,EAAAA,EAAKI,KAAI,CAAAF,SAAA,EACRC,EAAAA,EAAAA,MAACH,EAAAA,EAAKK,MAAK,CAACC,GAAG,KAAKL,UAAU,OAAMC,SAAA,CAC1B,OAAPtC,QAAO,IAAPA,GAAmB,QAAZmB,EAAPnB,EAASI,kBAAU,IAAAe,OAAZ,EAAPA,EAAqBwB,aAAa,IAAEhD,EAAE,YAExCW,GACCiC,EAAAA,EAAAA,MAAAK,EAAAA,SAAA,CAAAN,SAAA,EACEH,EAAAA,EAAAA,KAAA,OACEE,UAAU,QACVQ,MAAO,CAAEC,SAAU,SACnBC,IAAKzC,EACL0C,IAAK7C,KAEPgC,EAAAA,EAAAA,KAAA,OAAKE,UAAU,sBAAqBC,SACjC3C,EAAE,mBAAoB,CACrBQ,UAAkB,OAAPH,QAAO,IAAPA,GAAmB,QAAZoB,EAAPpB,EAASI,kBAAU,IAAAgB,OAAZ,EAAPA,EAAqBuB,oBAIpC,UAKL,IAAI,EAGb,GAAeM,EAAAA,EAAAA,MAAKxD,E,2FCrFb,MAAM6B,EAAeA,IAEnB4B,EAAAA,EAAQC,IADA,kCAIJxC,EAAoBD,IAC/B,MAAM0C,EAAS,wCAAwC1C,IACvD,OAAOwC,EAAAA,EAAQC,IAAiBC,EAAO,C","sources":["pages/UserCenter/Auth/components/WeCom/index.tsx","pages/UserCenter/Auth/components/WeCom/service.ts"],"sourcesContent":["/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport React, { memo, FC, useState, useEffect } from 'react';\nimport { Card } from 'react-bootstrap';\nimport { useTranslation } from 'react-i18next';\nimport { useNavigate } from 'react-router-dom';\n\nimport QrCode from 'qrcode';\n\nimport { userCenterStore } from '@/stores';\nimport { guard, getUaType, floppyNavigation } from '@/utils';\nimport { USER_AGENT_NAMES } from '@/common/constants';\n\nimport { getLoginConf, checkLoginResult } from './service';\n\nlet checkTimer: NodeJS.Timeout;\nconst Index: FC = () => {\n  const { t } = useTranslation('translation', { keyPrefix: 'user_center' });\n  const navigate = useNavigate();\n  const ucAgent = userCenterStore().agent;\n  const agentName = ucAgent?.agent_info?.name || '';\n  const [qrcodeDataUrl, setQrCodeDataUrl] = useState('');\n  const handleLoginResult = (key: string) => {\n    if (!key) {\n      return;\n    }\n    checkLoginResult(key).then((res) => {\n      if (res.is_login) {\n        guard.handleLoginWithToken(res.token, navigate);\n        return;\n      }\n      clearTimeout(checkTimer);\n      checkTimer = setTimeout(() => {\n        handleLoginResult(key);\n      }, 2000);\n    });\n  };\n  const handleQrCode = (targetUrl: string) => {\n    if (!targetUrl) {\n      return;\n    }\n    QrCode.toDataURL(targetUrl, { width: 240, margin: 0 }, (err, url) => {\n      if (err) {\n        return;\n      }\n      setQrCodeDataUrl(url);\n    });\n  };\n\n  useEffect(() => {\n    if (!agentName) {\n      return;\n    }\n    getLoginConf().then((res) => {\n      if (getUaType() === USER_AGENT_NAMES.WeCom) {\n        floppyNavigation.navigate(res?.redirect_url, {\n          handler: 'replace',\n        });\n      } else {\n        handleQrCode(res?.redirect_url);\n        handleLoginResult(res?.key);\n      }\n    });\n  }, [agentName]);\n  useEffect(() => {\n    return () => {\n      clearTimeout(checkTimer);\n    };\n  }, []);\n\n  if (getUaType() !== USER_AGENT_NAMES.WeCom) {\n    return (\n      <Card className=\"text-center\">\n        <Card.Body>\n          <Card.Title as=\"h3\" className=\"mb-3\">\n            {ucAgent?.agent_info?.display_name} {t('login')}\n          </Card.Title>\n          {qrcodeDataUrl ? (\n            <>\n              <img\n                className=\"w-100\"\n                style={{ maxWidth: '240px' }}\n                src={qrcodeDataUrl}\n                alt={agentName}\n              />\n              <div className=\"text-secondary mt-3\">\n                {t('qrcode_login_tip', {\n                  agentName: ucAgent?.agent_info?.display_name,\n                })}\n              </div>\n            </>\n          ) : null}\n        </Card.Body>\n      </Card>\n    );\n  }\n  return null;\n};\n\nexport default memo(Index);\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport request from '@/utils/request';\n\ntype loginConf = {\n  key: string;\n  redirect_url: string;\n};\n\ntype loginResult = {\n  is_login: boolean;\n  token: string;\n};\n\nexport const getLoginConf = () => {\n  const apiUrl = `/answer/api/v1/wecom/login/url`;\n  return request.get<loginConf>(apiUrl);\n};\n\nexport const checkLoginResult = (key: loginConf['key']) => {\n  const apiUrl = `/answer/api/v1/wecom/login/check?key=${key}`;\n  return request.get<loginResult>(apiUrl);\n};\n"],"names":["checkTimer","Index","_ucAgent$agent_info","t","useTranslation","keyPrefix","navigate","useNavigate","ucAgent","userCenterStore","agent","agentName","agent_info","name","qrcodeDataUrl","setQrCodeDataUrl","useState","handleLoginResult","key","checkLoginResult","then","res","is_login","guard","token","clearTimeout","setTimeout","_ucAgent$agent_info2","_ucAgent$agent_info3","useEffect","getLoginConf","targetUrl","getUaType","USER_AGENT_NAMES","WeCom","floppyNavigation","redirect_url","handler","QrCode","width","margin","err","url","_jsx","Card","className","children","_jsxs","Body","Title","as","display_name","_Fragment","style","maxWidth","src","alt","memo","request","get","apiUrl"],"sourceRoot":""}