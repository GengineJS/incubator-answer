{"version":3,"file":"static/js/4806.f609277a.chunk.js","mappings":"oPA8BA,MAkGA,EAlGkBA,KAChB,MAAM,EAAEC,IAAMC,EAAAA,EAAAA,GAAe,cAAe,CAC1CC,UAAW,gBAEPC,GAAQC,EAAAA,EAAAA,MAERC,EAAqB,CACzBC,MAAON,EAAE,cACTO,SAAU,CAAC,mBAAoB,kBAC/BC,WAAY,CACVC,iBAAkB,CAChBC,KAAM,SACNJ,MAAON,EAAE,0BACTW,YAAaX,EAAE,0BAEjBY,eAAgB,CACdF,KAAM,SACNJ,MAAON,EAAE,wBACTW,YAAaX,EAAE,2BAkBda,EAAUC,IAAeC,EAAAA,EAAAA,WAASC,EAAAA,EAAAA,IAAaX,KAgCtDY,EAAAA,EAAAA,YAAU,MACRC,EAAAA,EAAAA,MAAkBC,MAAMC,IACtB,GAAIA,EAAS,CACX,MAAMC,EAAW,IAAKR,GACtBQ,EAASZ,iBAAiBa,MACxBF,EAAQG,+BACVF,EAAST,eAAeU,MAAQF,EAAQI,6BACxCV,EAAYO,EACd,IACA,GACD,IAMH,OACEI,EAAAA,EAAAA,MAAAC,EAAAA,SAAA,CAAAC,SAAA,EACEC,EAAAA,EAAAA,KAAA,MAAIC,UAAU,OAAMF,SAAE3B,EAAE,iBACxB4B,EAAAA,EAAAA,KAACE,EAAAA,EAAU,CACTzB,OAAQA,EACRQ,SAAUA,EACVkB,SApDYC,IAChBA,EAAIC,iBACJD,EAAIE,kBAEJ,MAAMC,EAAqC,CACzCZ,+BAAgCV,EAASJ,iBAAiBa,MAC1Dc,6BAA8BC,EAAAA,GAAOC,MACnCzB,EAASJ,iBAAiBa,OAE5BE,6BAA8BX,EAASD,eAAeU,MACtDiB,2BAA4BF,EAAAA,GAAOC,MAAMzB,EAASD,eAAeU,SAGnEkB,EAAAA,EAAAA,IAAgBL,GACbhB,MAAK,KACJhB,EAAMsC,OAAO,CACXC,IAAK1C,EAAE,SAAU,CAAEE,UAAW,UAC9ByC,QAAS,WACT,IAEHC,OAAOC,IACN,GAAIA,EAAIC,QAAS,CACf,MAAMC,GAAOC,EAAAA,EAAAA,IAAgBH,EAAKhC,GAClCC,EAAY,IAAKiC,IACjB,MAAME,EAAMC,SAASC,eAAeN,EAAIO,KAAK,GAAGC,cAChDC,EAAAA,EAAAA,IAAmBL,EACrB,IACA,EA0BAM,SArEqB,CACzB9C,iBAAkB,CAChB,YAAa,WACb,aAAc,CACZ+C,KAAM,KAGV5C,eAAgB,CACd,YAAa,WACb,aAAc,CACZ4C,KAAM,MA4DNC,SAZkBV,IACtBjC,EAAYiC,EAAK,MAad,C","sources":["pages/Admin/Legal/index.tsx"],"sourcesContent":["/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { FC, useEffect, useState } from 'react';\nimport { useTranslation } from 'react-i18next';\n\nimport { marked } from 'marked';\n\nimport type * as Type from '@/common/interface';\nimport { SchemaForm, JSONSchema, initFormData, UISchema } from '@/components';\nimport { useToast } from '@/hooks';\nimport { getLegalSetting, putLegalSetting } from '@/services';\nimport { handleFormError, scrollToElementTop } from '@/utils';\n\nconst Legal: FC = () => {\n  const { t } = useTranslation('translation', {\n    keyPrefix: 'admin.legal',\n  });\n  const Toast = useToast();\n\n  const schema: JSONSchema = {\n    title: t('page_title'),\n    required: ['terms_of_service', 'privacy_policy'],\n    properties: {\n      terms_of_service: {\n        type: 'string',\n        title: t('terms_of_service.label'),\n        description: t('terms_of_service.text'),\n      },\n      privacy_policy: {\n        type: 'string',\n        title: t('privacy_policy.label'),\n        description: t('privacy_policy.text'),\n      },\n    },\n  };\n  const uiSchema: UISchema = {\n    terms_of_service: {\n      'ui:widget': 'textarea',\n      'ui:options': {\n        rows: 10,\n      },\n    },\n    privacy_policy: {\n      'ui:widget': 'textarea',\n      'ui:options': {\n        rows: 10,\n      },\n    },\n  };\n  const [formData, setFormData] = useState(initFormData(schema));\n\n  const onSubmit = (evt) => {\n    evt.preventDefault();\n    evt.stopPropagation();\n\n    const reqParams: Type.AdminSettingsLegal = {\n      terms_of_service_original_text: formData.terms_of_service.value,\n      terms_of_service_parsed_text: marked.parse(\n        formData.terms_of_service.value,\n      ),\n      privacy_policy_original_text: formData.privacy_policy.value,\n      privacy_policy_parsed_text: marked.parse(formData.privacy_policy.value),\n    };\n\n    putLegalSetting(reqParams)\n      .then(() => {\n        Toast.onShow({\n          msg: t('update', { keyPrefix: 'toast' }),\n          variant: 'success',\n        });\n      })\n      .catch((err) => {\n        if (err.isError) {\n          const data = handleFormError(err, formData);\n          setFormData({ ...data });\n          const ele = document.getElementById(err.list[0].error_field);\n          scrollToElementTop(ele);\n        }\n      });\n  };\n\n  useEffect(() => {\n    getLegalSetting().then((setting) => {\n      if (setting) {\n        const formMeta = { ...formData };\n        formMeta.terms_of_service.value =\n          setting.terms_of_service_original_text;\n        formMeta.privacy_policy.value = setting.privacy_policy_original_text;\n        setFormData(formMeta);\n      }\n    });\n  }, []);\n\n  const handleOnChange = (data) => {\n    setFormData(data);\n  };\n\n  return (\n    <>\n      <h3 className=\"mb-4\">{t('page_title')}</h3>\n      <SchemaForm\n        schema={schema}\n        formData={formData}\n        onSubmit={onSubmit}\n        uiSchema={uiSchema}\n        onChange={handleOnChange}\n      />\n    </>\n  );\n};\n\nexport default Legal;\n"],"names":["Legal","t","useTranslation","keyPrefix","Toast","useToast","schema","title","required","properties","terms_of_service","type","description","privacy_policy","formData","setFormData","useState","initFormData","useEffect","getLegalSetting","then","setting","formMeta","value","terms_of_service_original_text","privacy_policy_original_text","_jsxs","_Fragment","children","_jsx","className","SchemaForm","onSubmit","evt","preventDefault","stopPropagation","reqParams","terms_of_service_parsed_text","marked","parse","privacy_policy_parsed_text","putLegalSetting","onShow","msg","variant","catch","err","isError","data","handleFormError","ele","document","getElementById","list","error_field","scrollToElementTop","uiSchema","rows","onChange"],"sourceRoot":""}