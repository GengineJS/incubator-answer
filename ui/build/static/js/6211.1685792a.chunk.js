"use strict";(globalThis.webpackChunkanswer_static=globalThis.webpackChunkanswer_static||[]).push([[6211],{16211:(e,n,t)=>{t.r(n),t.d(n,{default:()=>k});var s=t(28915),a=t(46261),i=t(83556),r=t(53799),l=t(67324),o=t(51588),c=t(31574),d=t(65200),u=t(68223),v=t(14577),h=t.n(v),m=t(47185),x=t(25831),w=t(81801),g=t(48058),j=t(4440),_=t(76812),f=t(24978),p=t(15480),I=t(68179);const b=new j.ZT({type:"answer"}),N=({visible:e=!1,data:n,callback:t})=>{const{t:v}=(0,o.B)("translation",{keyPrefix:"question_detail.write_answer"}),[N,k]=(0,s.useState)({content:{value:"",isInvalid:!1,errorMsg:""}}),[A,y]=(0,s.useState)(e),[C,q]=(0,s.useState)(""),[S,E]=(0,s.useState)(!1),[F,L]=(0,s.useState)(!1),[M,T]=(0,s.useState)(n.loggedUserRank<100),P=(0,x.T5)("answer"),G=(0,f.j7)((e=>e.write)),[K,B]=(0,s.useState)(!1),[R,Q]=(0,s.useState)(!1);(0,m.XB)({when:Boolean(N.content.value)});const U=(0,f.bb)((e=>e.user));p.fj.GetInstance().addAICallback("AIHandle",(e=>{if(!R)return;const n=e.data;JSON.parse(n).user_id===U.id&&(p.fj.GetInstance().removeAIEventListener(),Q(!1),window.location.reload())}));const V=()=>{b.save.cancel(),b.remove(),L(!1)};(0,s.useEffect)((()=>{const e=j.KP.get(_.tQ);(null===e||void 0===e?void 0:e.questionId)===n.qid&&null!==e&&void 0!==e&&e.content&&(y(!0),k({content:{value:e.content,isInvalid:!1,errorMsg:""}}),L(!0)),setTimeout((()=>{B(!0)}),100)}),[]),(0,s.useEffect)((()=>{const e=j.KP.get(_.tQ),{content:t}=N;t.value?(b.save({questionId:null===n||void 0===n?void 0:n.qid,content:t.value}),L(!0)):(null===e||void 0===e?void 0:e.questionId)!==n.qid||t.value||V()}),[N.content.value]);const $=(e=!1)=>{const s={question_id:null===n||void 0===n?void 0:n.qid,content:e?"AIReply":N.content.value,html:u.xI.parse(N.content.value)},a=null===P||void 0===P?void 0:P.getCaptcha();null!==a&&void 0!==a&&a.verify&&(s.captcha_code=a.captcha_code,s.captcha_id=a.captcha_id),(e?(0,g.tP)(s):(0,g.V_)(s)).then((async n=>{await(null===P||void 0===P?void 0:P.close()),y(!1),k({content:{value:"",isInvalid:!1,errorMsg:""}}),V(),null===t||void 0===t||t(n.info),e&&(p.fj.GetInstance().removeAIEventListener(),Q(!1))})).catch((e=>{if(e.isError){null===P||void 0===P||P.handleCaptchaError(e.list);const n=(0,j.NC)(e,N);k({...n})}}))},H=()=>{j.ah.tryNormalLogged(!0)&&(()=>{let e=!0;const{content:n}=N;return!n.value||Array.from(n.value.trim()).length<6?(e=!1,N.content={value:n.value,isInvalid:!0,errorMsg:v("characters")}):N.content={value:n.value,isInvalid:!1,errorMsg:""},k({...N}),e})()&&(P?P.check((()=>$())):$())},J=()=>{j.ah.tryNormalLogged(!0)&&(null===n||void 0===n||!n.answered||A?A?H():y(!0):w.aF.confirm({title:v("confirm_title"),content:v("confirm_info"),confirmText:v("continue"),onConfirm:()=>{y(!0)}}))};return(0,I.jsxs)(a.A,{noValidate:!0,className:"mt-4",children:[(0,I.jsx)(w.Ru,{loading:R,color:"#3f51b5"}),(!n.answered||A)&&(0,I.jsxs)(a.A.Group,{className:"mb-3",children:[(0,I.jsx)(a.A.Label,{children:(0,I.jsx)("h5",{children:v("title")})}),(0,I.jsx)(a.A.Control,{isInvalid:N.content.isInvalid,className:"d-none"}),!A&&!n.answered&&(0,I.jsx)("div",{className:"d-flex",children:(0,I.jsx)(w.fs,{className:"w-100",rows:8,autoFocus:!1,onFocus:e=>{j.ah.tryNormalLogged(!0)?(q("answer"),y(!0),E(!0)):e.currentTarget.blur()}})}),A&&(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(w.KE,{className:h()("form-control p-0","answer"===C&&"focus"),value:N.content.value,autoFocus:S,onChange:e=>{K&&k({content:{value:e,isInvalid:!1,errorMsg:""}})},onFocus:()=>{q("answer")},onBlur:()=>{q("")}}),(0,I.jsxs)(i.A,{variant:"warning",show:n.loggedUserRank<100&&M,onClose:()=>T(!1),dismissible:!0,className:"mt-3",children:[(0,I.jsx)("p",{children:v("tips.header_1")}),(0,I.jsxs)("ul",{children:[(0,I.jsx)("li",{children:(0,I.jsx)(c.x,{i18nKey:"question_detail.write_answer.tips.li1_1",components:{strong:(0,I.jsx)("strong",{})}})}),(0,I.jsx)("li",{children:v("tips.li1_2")})]}),(0,I.jsx)("p",{children:(0,I.jsx)(c.x,{i18nKey:"question_detail.write_answer.tips.header_2",components:{strong:(0,I.jsx)("strong",{})}})}),(0,I.jsx)("ul",{className:"mb-0",children:(0,I.jsx)("li",{children:v("tips.li2_1")})})]})]}),(0,I.jsx)(a.A.Control.Feedback,{type:"invalid",children:N.content.errorMsg})]}),n.answered&&!A?(0,I.jsx)(d.N_,{to:`/posts/${n.qid}/${n.first_answer_id}/edit`,className:"btn btn-primary",children:v("edit_answer")}):(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(r.A,{className:"me-3",onClick:J,children:v("btn_name")}),n.aiAnswered?(0,I.jsx)("div",{className:"lh-1 btn m-0",children:(0,I.jsxs)(l.A,{bg:"secondary",pill:!0,children:[(0,I.jsx)(w.In,{name:"check-circle-fill  me-1"}),v("ai_answered")]})}):(0,I.jsx)(r.A,{onClick:()=>{j.ah.tryNormalLogged(!0)&&(p.fj.GetInstance().addAIEventListener(),Q(!0),$(!0))},children:v("btn_ai_name")})]}),n.answered&&!A&&!G.restrict_answer&&(0,I.jsx)(r.A,{onClick:J,className:"ms-2 ",variant:"outline-primary",children:v("add_another_answer")}),F&&(0,I.jsx)(r.A,{variant:"link",className:"ms-2",onClick:()=>{window.confirm(v("discard_confirm",{keyPrefix:"draft"}))&&(V(),k({content:{value:"",isInvalid:!1,errorMsg:""}}))},children:v("discard_draft",{keyPrefix:"btns"})})]})},k=(0,s.memo)(N)}}]);
//# sourceMappingURL=6211.1685792a.chunk.js.map